# LPWA(Private LoRa)試験機マニュアル

## LPWA（LoRaWAN)試験機とは？

LPWA(LoRaWAN)試験機は、GNSSモジュールとLoRa通信モジュールを搭載し、子機の位置情報をLoRa通信で親機側へ定期的に発信し続けることのできる機器です。計測結果を地図上に表示させることで、電波の到達範囲や電波状況を視覚的に確認することができます。

実際のLoRa通信機器の導入前の測定試験として利用することができます。

## 貸出品一式

- 親機: 1台
  - AC100V電源で動作します
- 子機: 2台
  - モバイルバッテリーで動作します
- モバイルバッテリー（電源アダプタ付き）: 1台
  - 事前に満充電であることを確認してください

なお、貸出時のLoRa通信モジュールの設定は以下の値になっています。

| パラメータ | 設定値 |
----|---- 
| Bandwidth | 125kHz |
| Spreading Factor | 7 |
| Channel | 1 |
| Retry Count | 3 |
| Transmit Power | 13dBm |

## 使い方

使い方は非常にシンプルです。
親機を適切な場所に設置して電源を投入するだけで、あとは子機の電源を入れて、GNSSからの緯度経度情報とあわせて電波状況を定期的にアップロードします。発信周期は10秒と30秒の2種類から選択可能です。

計測機に関する詳細情報は同梱のマニュアルをご確認ください。

### その1. 設置する

親機と子機にそれぞれアンテナを取り付け、まずは親機を適当な場所に設置して電源を入れます。親機はAC100V電源での動作になります。

電源投入後、箱内に設置されたUSBドングルが青点灯状態（LTEネットワークに接続し通信可能）になるまで待ちます。USBドングルが青点灯状態にならない場合は、LTE電波が弱いため子機から受信した情報をアップロードすることができません。設置位置を変更するなどの工夫が必要になる可能性があります。

![lora_parent](https://user-images.githubusercontent.com/4217754/47612703-2809aa00-dac3-11e8-9ed5-d64ddb48a301.png)

### その2. データを収集する

子機をモバイルバッテリーに接続して電源を入れます。電源投入後、(衛星からの電波が安定している状態において）数分程度で緯度経度情報の計算ができ、GPSのLEDが点滅しますので、しばらく待ちます。

![lora_child](https://user-images.githubusercontent.com/4217754/47612711-57b8b200-dac3-11e8-937d-a136483b60da.png)

なお、基板上の各種LEDが定期的に点滅しますが、意味は以下の通りです。つまり、正常に電波の到達範囲に子機が存在している場合には 「SND/GPS → OK/GPS」の点滅の繰り返しになります。通常は、5秒〜10秒に1回の間隔で送信されます。

| 名称 | 動作 |
----|---- 
| SND | 親機へデータ送信時点灯 |
| PW | 電源供給時点灯 |
| GPS | 送信時にGNSS受信に成功した場合点灯（消灯時は緯度経度情報が送信されません） |
| ERR | エラー時点灯 |
| OK | 送信成功時点灯 |
| DATA | 送信失敗データがあるときに点灯 |
| NG | 失敗時点灯（ACK応答が得られない場合） |
| 1PPS | 1秒ごとのGNSS受診時に時刻同期に成功している状態で常時点滅 |


### その3. 可視化する

アップロードされたデータはウェブインタフェースを通して可視化することができます。以下のURLにアクセスします。

- [可視化サイトのURL]

URLにアクセスすると、地図とコントロールパネルが表示されます。画面レイアウトと各種機能については以下の通りです。

![web](https://user-images.githubusercontent.com/4217754/47617142-b4d65700-db07-11e8-8813-220db50bb3af.png)

カレンダーボタンからデータ取得をした日付を選択し、デバイスを選択して表示時間を調整することで、地図上に電波測定結果が表示されます。カレンダー上で日付を選択する際に、「Include cordinator in download data」にチエックを入れると、親機の情報もあわせてダウンロードされます。

![1](https://user-images.githubusercontent.com/4217754/47617196-3928da00-db08-11e8-96c6-5cf075102285.png)
![2](https://user-images.githubusercontent.com/4217754/47617197-3928da00-db08-11e8-84a6-89b4c528b85a.png)
![3](https://user-images.githubusercontent.com/4217754/47617200-3a5a0700-db08-11e8-811b-5da1ecb22701.png)

リアルタイムにアップロードされたデータを可視化するには、左下の「時間の操作」パネル内にある時計マークをクリックします。測定からウェブ画面反映までの所要時間は数秒ですので、ほぼリアルタイムで測定結果を確認することができます。

## 次のステップへ
TBD

## 注意事項
TBD


